# This action triggers a GitLab CI job that performs the following:
# * Srtool Check
# * Subwasm info of the compressed wasm file
# * Generate Release Notes
# * Propose a Parachain Upgrade
name: Release and Propose an Upgrade

on:
  pull_request:
    types:
      - closed
    branches:
      - 'main'

jobs:
  release_check:
#    This job will only run if:
#     * the pull request is closed and merged to main branch;
#     * the pull request has the "release:" in its title
    if: ${{ github.event.pull_request.merged == true && contains(github.event.pull_request.title, 'release:') }}
    name: Is ${{ matrix.chain }} need new release ${{ github.event.inputs.ref }}
    strategy:
      fail-fast: true
      matrix:
        chain: ["amplitude", "pendulum"]
        shouldReleaseAmp:
          - ${{ contains(github.event.pull_request.title, 'amplitude') }}
        shouldReleasePen:
          - ${{ contains(github.event.pull_request.title, 'pendulum') }}
        exclude:
          - shouldReleaseAmp: false
            chain: "amplitude"
          - shouldReleasePen: false
            chain: "pendulum"
    runs-on: ubuntu-latest

#    steps:
#      - name: trigger GitLab Ci Job
#        uses: appleboy/gitlab-ci-action@master
#        with:
#          host: "https://gitlab.com"
#          token: ${{ secrets.GITLABAPI }}
#          project_id: 51267165
#          debug: true
#          ref: development

